# 내용 정리

- 모든 클래스를 상태 변경이 불가능한 불변 클래스(immutable class)로 구현하면 유지보수성을 크게 향상시킬 수 있다.
- 불변성 역시 크기가 작고 응집력이 높으며 느슨하게 결합되고 유지보수하기 쉬운 클래스를 만들 수 있도록 한다.
- 가변 객체는 객체 패러다임의 오용이다.
- 지연 로딩 기법을 사용하면 객체가 캡슐화하고 있는 프로퍼티를 업데이트할 필요가 있을 때 프로퍼티를 ‘게으르게(lazily)’ 로드할 수 있다. (자바에서는 불가능하다)

## 식별자 가변성(Identity Mutablility)

- 불변 객체는 ‘식별자 가변성(identity mutability)’ 문제가 없다.
    - 두 객체를 비교한 후 객체의 상태를 변경하면 더 이상 동일한 객체가 아니지만 우리는 두 객체가 동일하다고 생각한다.
- 식별자로 비교해서 같다고 생각한 객체들이 가변 객체일 경우 다른 객체로 변경이 될 수 있다. 불변 객체는 이러한 문제가 없다.

## 실패 원자성(Failure Atomicity)

- 실패 원자성이란 완전하고 견고한 상태의 객체를 가지거나 실패하거나 둘 중하나만 가능한 특성이다.
- 가변 객체를 사용할 때는 값에 변화를 줄 때 유효하지 않는 값이 필드로 들어올 때 예외를 던지는 방법으로 계산해야 한다.
- 반면 불변 객체를 사용하면 별도의 처리 없이도 원자성을 얻을 수 있다.
    - 불변 객체의 정의에 따르면 모든 불변 객체는 ‘원자적'이기 때문이다.
- 가변 객체 안에서 명시적으로 실패 원자성을 보장하는 방법은 복잡성이 높아지고 그 때문에 실수한 가능성이 더 커진다. 물론 객체의 유지보수성 역시 심각한 영향이 된다.

## 시간적 결합(Temporal Coupling)

- Java는 모든 private 프로퍼티가 null값을 가지도록 골격(skeleton)을 만들고 setter를 이용해 프로퍼티 값을 초기화한다. JavaBeans, JPA, JAXB 등 다양한 표준에서 Java 객체를 조작하기 위해 권장하는 방식이다.
- 진정한 ‘객체 사고(object thinkin)’의 관점에서는 잘못된 방식이다.
- 객체를 만든다음 프로퍼티 값을 채워넣는 방식은 식의 순서가 생긴다.
- 가변 객체의 수가 많은 상황에서 가변 객체를 처리하는 연산의 순서를 기억해야 한다면 유지보수에 있어 어려움이 있다.
- 하나의 문장으로 인스턴스화(intantiation)와 초기화(initialization)을 분리할 수 없다.
- 불변성을 사용하면 코드 전반적으로 구문 사이에 존재하는 시간적인 결합을 제거할 수 있다.
- 객체를 사용해서 어떤 일을 수행하려면 그 전에 객체를 완전한 상태로 초기화해야 한다.

## 부수효과 제거(Side effect-free)

- 불변 객체는 객체를 수정할 수 없다. 그래서 부수효과가 발생하지 않는다.

## NULL 참조 없애기

- 실제 값이 아닌 NULL을 참조하는 객체는 유지보수성이 저하될 수밖에 없다. 언제 객체가 유효한 상태고 언제 객체가 아닌 다른 형태로 바뀌는지를 이해하기 어렵기 때문이다.
- 커다란 클래스를 만드는 이유는 우리가 더 작은 부분으로 분해하기 위해 상속과 캡슐화를 어떻게 사용하는지 모르기 때문이다.
- 모든 객체를 불변으로 만들면 객체 안에 NULL을 포함시키는 것이 애초에 불가능해진다. 다시말해 작고 견고하고 높은 응집도의 객체를 생성할 수 밖에 없게 강제되기 때문에 결과적으로 유지보수하기 더 쉬운 객체를 만들게 된다.

## 스레드 안정성

- 스레드 안정성(Thread Safety)이란 객체가 여러 스레드에서 동시에(concurrently) 사용될 수 있으며 그 결과 항상 예측가능하도록 유지할 수 있는 객체의 품질을 의미한다.
- 불변 객체는 실행 시점에서 상태를 수정할 수 없게 금지함으로서 이 문제를 완벽하게 해결한다.
- 어떤 스레드도 객체의 상태를 수정할 수 없기 때문에 문제가 없다.
- 가변 객체에서 스레드 안정적으로 만드는 경우 각 스레드는 객체를 배타적으로 잠그기 때문에 다른 모든 스레드는 객체가 해제될 때 까지 넋놓고 기다릴 수 있으며 데드락이 발생할 수 있다. 데드락을 제어하는 것은 어렵다.

## 더 작고 더 단순한 객체

- 불변성의 장점인 단순성(simplicity)가 있다. 객체가 더 단순해질수록 응집도는 높아지고 유지보수하기는 쉬워진다. 유지보수성은 현대적인 프로그래밍이 갖춰야 하는 가장 중요한 덕목이다.
- 자바에서 250줄을 넘는 클래스는 리팩토링이 필요하다.
- 불변 객체를 아주 크게 만드는 일은 불가능하다. 불변 객체가 작은 이유는 생성자 안에서만 상태를 초기화할 수 있기 때문이다.
- 객체에 기능을 추가할 때마다 객체의 크기가 점점 커진다. 그러면 생성자 역시 더 커진다. 생성자가 커지면 현재 작업중인 클래스를 더 깔끔하고 짧게 만든다.
- 가변 객체는 절차적인 프로그래밍의 끔찍한 유산이다.

# 느낀점

- 함수형 프로그래밍에서는 불변객체만을 사용한다.
- 불변객체의 장점은 수없이 많고 굉장히 논리적으로 책에 설명되어있다. 하지만 언급했듯 자바 진영에서는 자바빈즈 규약이라는 표준을 기반으로 만들어진 라이브러리가 많다. 또한 JPA의 엔티티도 가변 객체이다.
- 따라서 가변 객체를 사용해야하는 경우는 중요한 로직을 다룰때에만 사용이 된다. 이를 둘러싼 개발을 불변객체로 사용하므로써 가변객체의 스코프를 최소하게 잡아가도록 노력해야겠다.
